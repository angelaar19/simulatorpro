<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Simulador Mundial de Clubes 2025</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        --naranja: #ff7300;
        --naranja-oscuro: #ba4700;
        --naranja-mas-oscuro: #873100;
        --negro: #181818;
        --gris: #232323;
        --blanco: #fffbe3;
        --result-box-width: 60px; /* Ajuste para que sean proporcionales */
        --result-input-width: 40px; /* Tamaño uniforme para los inputs */
      }
      body {
        background: var(--negro);
        color: var(--naranja);
        font-family: 'Montserrat', Arial, sans-serif;
        margin: 0;
        min-height: 100vh;
      }
      h1 {
        margin-top: 32px;
        font-size: 2.2em;
        text-align: center;
        font-family: 'Anton', 'Montserrat', Impact, Arial;
        text-shadow: 0 3px 20px #000a, 0 2px 12px #ff730088, 0 2px 1px #fff6;
        background: linear-gradient(90deg, #fffbe3 5%, #ff7300 50%, #ba4700 95%);
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        letter-spacing: 0.09em;
      }
      .grupos-nav-bar {
        margin: 22px 0 18px 0;
        display: flex;
        flex-wrap: wrap;
        gap: 14px;
        justify-content: center;
        width: 100%;
      }
      .grupos-nav-btn {
        background: var(--negro);
        color: var(--naranja);
        border: 2.5px solid var(--naranja-oscuro);
        border-radius: 11px;
        font-size: 1.2em;
        font-family: 'Montserrat', Arial, sans-serif;
        font-weight: 900;
        padding: 12px 30px;
        margin: 0 7px;
        box-shadow: 0 3px 18px #000b;
        cursor: pointer;
        transition: background 0.18s, color 0.18s, box-shadow 0.18s, border 0.18s, transform 0.18s;
        text-decoration: none;
        outline: none;
        letter-spacing: 0.06em;
        text-align: center;
        min-width: 52px;
      }
      .grupos-nav-btn.active,
      .grupos-nav-btn:hover,
      .grupos-nav-btn:focus-visible {
        background: var(--naranja-oscuro);
        color: var(--blanco);
        border-color: var(--naranja);
        box-shadow: 0 0 21px 2px #ff730077, 0 2px 24px #0008;
        outline: none;
        transform: scale(1.06);
        font-weight: 900;
      }
      .automatic-button {
        background: var(--naranja);
        color: var(--blanco);
        border: 2px solid var(--naranja-oscuro);
        border-radius: 8px;
        padding: 10px 20px;
        font-size: 1.1em;
        cursor: pointer;
        transition: background 0.2s, transform 0.2s;
        font-family: 'Montserrat', Arial, sans-serif;
        margin: 12px auto;
        display: block;
      }
      .automatic-button:hover {
        background: var(--naranja-oscuro);
        transform: scale(1.05);
      }
      .grupos-content {
        display: flex;
        justify-content: center;
        align-items: flex-start;
        flex-wrap: wrap;
        width: 100vw;
      }
      .grupo-box {
        background: var(--gris);
        border-radius: 15px;
        border: 3px solid var(--naranja-oscuro);
        padding: 18px 2vw 28px 2vw;
        min-width: 320px;
        width: 90vw;
        max-width: 1100px;
        margin: 8px auto 30px auto;
        box-shadow: 0 3px 20px #000b;
        color: var(--blanco);
        display: none;
        flex-direction: column;
        align-items: center;
        transition: width 0.2s;
      }
      .grupo-box.active {
        display: flex;
      }
      .grupo-nombre {
        color: var(--naranja);
        font-size: 2em;
        font-weight: 900;
        margin-bottom: 12px;
        font-family: 'Montserrat', Arial, sans-serif;
        letter-spacing: 0.08em;
        text-align: center;
        text-shadow: 0 2px 12px #ff730055, 0 2px 1px #fff6;
        text-transform: uppercase;
        width: 100%;
        overflow-wrap: break-word;
      }
      .tabla-posiciones-wrapper {
        overflow-x: auto;
        width: 100%;
        margin-bottom: 20px;
      }
      table.posiciones {
        margin: 0 auto 10px auto;
        width: 100%;
        min-width: 680px;
        background: #1d1108;
        border-radius: 11px;
        border: 2.5px solid var(--naranja-oscuro);
        border-collapse: separate;
        border-spacing: 0;
        box-shadow: 0 3px 18px #0007;
        font-size: 1.10em;
      }
      table.posiciones thead th {
        background: var(--naranja-mas-oscuro);
        color: var(--blanco);
        font-size: 1.16em;
        font-family: 'Montserrat', Arial, sans-serif;
        font-weight: 900;
        letter-spacing: 0.05em;
        border-bottom: 3.5px solid var(--naranja);
        padding: 13px 5px;
        text-align: center;
      }
      table.posiciones th:first-child,
      table.posiciones td:first-child {
        border-radius: 10px 0 0 10px;
      }
      table.posiciones th:last-child,
      table.posiciones td:last-child {
        border-radius: 0 10px 10px 0;
      }
      table.posiciones tbody tr {
        background: #312111;
        transition: background 0.15s;
      }
      table.posiciones tbody tr.primeros {
        background: #ff730025 !important;
      }
      table.posiciones tbody tr:hover {
        background: #ff730010;
      }
      table.posiciones td {
        font-family: 'Montserrat', Arial, sans-serif;
        text-align: center;
        padding: 12px 4px;
        border-bottom: 1.5px solid var(--naranja-oscuro);
        font-size: 1.07em;
        color: var(--blanco);
        vertical-align: middle;
        line-height: 1.2;
        min-width: 53px;
      }
      table.posiciones td.equipo-nombre {
        font-family: 'Rubik', 'Montserrat', Arial, sans-serif;
        text-align: left;
        font-size: 1.11em;
        font-weight: 800;
        color: var(--naranja);
        min-width: 160px;
        max-width: 300px;
        white-space: normal;
        overflow-wrap: break-word;
        letter-spacing: 0.01em;
      }
      table.posiciones td img {
        vertical-align: middle;
        margin-right: 4px;
        width: 34px;
        height: 23px;
      }
      .bandera-equipo {
        width: 34px;
        height: 23px;
        object-fit: cover;
        border-radius: 4px;
        background: #fff;
        border: 1.5px solid var(--naranja-oscuro);
        margin-right: 7px;
        box-shadow: 0 0 3px #000a;
        vertical-align: middle;
      }
      .grupo-partidos {
        margin: 0 0 16px 0;
        width: 100%;
        max-width: 100vw;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .partido-grupo {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0;
        margin-bottom: 4px;
        font-size: 1.15em;
        flex-wrap: nowrap;
        width: 100%;
        min-width: 340px;
      }
      .equipo-partido {
        display: flex;
        align-items: center;
        min-width: 0;
        font-family: 'Rubik', 'Montserrat', Arial, sans-serif;
        font-size: 1.12em;
        color: var(--naranja);
        font-weight: 900;
        letter-spacing: 0.04em;
        white-space: normal;
        overflow-wrap: break-word;
        flex: 1 1 215px;
        height: 55px;
        justify-content: flex-end;
      }
      .equipo-partido.equipo-local {
        justify-content: flex-end;
        padding-right: 16px;
      }
      .equipo-partido.equipo-visitante {
        justify-content: flex-start;
        padding-left: 16px;
      }
      .resultado-box,
      .resultado-elim-box {
        display: flex;
        align-items: center;
        justify-content: center;
        width: var(--result-box-width);
        height: 55px;
      }
      .resultado-input,
      .resultado-elim-input {
        width: var(--result-input-width);
        font-size: 1.18em;
        border: 2px solid var(--naranja);
        border-radius: 8px;
        padding: 6px 0;
        background: var(--negro);
        color: var(--naranja);
        text-align: center;
        font-family: 'Rubik', Arial, sans-serif;
        font-weight: 900;
        margin: 0;
        outline: none;
        box-shadow: 0 1px 9px #000b;
        transition: border 0.2s;
        appearance: textfield;
      }
      /* Removemos las flechas de los inputs numéricos en todos los navegadores */
      .resultado-input::-webkit-outer-spin-button,
      .resultado-input::-webkit-inner-spin-button,
      .resultado-elim-input::-webkit-outer-spin-button,
      .resultado-elim-input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }
      .resultado-input[type=number],
      .resultado-elim-input[type=number] {
        -moz-appearance: textfield;
      }
      .resultado-input:focus,
      .resultado-elim-input:focus {
        border-color: var(--naranja-oscuro);
        background: var(--gris);
      }
      .guion-res {
        width: var(--result-box-width);
        text-align: center;
        color: var(--naranja);
        font-size: 1.3em;
        font-weight: bold;
        margin: 0;
        height: 55px;
        line-height: 55px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      /* Estilos de Eliminatorias: Alineación y consistencia en los inputs */
      .partido-elim {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0;
        margin-bottom: 4px;
        font-size: 1.15em;
        flex-wrap: nowrap;
        width: 100%;
        min-width: 340px;
        background: #312111CC;
        border-radius: 9px;
        padding: 12px 14px;
        box-shadow: 0 2px 12px #0006;
      }
      .partido-elim .num {
        font-size: 0.96em;
        color: var(--naranja);
        font-weight: 700;
        min-width: 100px;
        text-align: left;
        letter-spacing: 0.03em;
      }
      .partido-elim .etiqueta {
        display: flex;
        align-items: center;
        min-width: 0;
        font-family: 'Rubik', 'Montserrat', Arial, sans-serif;
        font-size: 1em;
        color: var(--naranja);
        font-weight: 700;
        letter-spacing: 0.04em;
        white-space: normal;
        overflow-wrap: break-word;
        flex: 1 1 215px;
        height: 55px;
      }
      .partido-elim .etiqueta:first-of-type {
        justify-content: flex-end;
        padding-right: 16px;
      }
      .partido-elim .etiqueta:last-of-type {
        justify-content: flex-start;
        padding-left: 16px;
      }
      /* Ajuste de contenedores de eliminatorias */
      .eliminatorias-round,
      .cuadro-elim {
        max-width: 900px;
        margin: 0 auto 38px auto;
        background: var(--gris);
        border-radius: 15px;
        border: 3px solid var(--naranja-oscuro);
        box-shadow: 0 3px 20px #000b;
        padding: 24px 3vw 24px 3vw;
        display: flex;
        flex-direction: column;
        gap: 16px;
      }
    </style>
  </head>
  <body>
    <h1>Simulador Mundial de Clubes 2025</h1>
    <div class="grupos-nav-bar" id="gruposNav"></div>
    <div class="grupos-content" id="gruposContent"></div>
    <!-- Botón de Resultados Automáticos para la fase de grupos -->
    <div style="text-align:center;margin:24px 0;">
      <button id="btnResultadosAutomaticos" class="automatic-button">Resultados Automáticos</button>
    </div>
    <div style="text-align:center;margin:24px 0;">
      <button id="btnAvanzarElim" class="automatic-button" disabled style="opacity:0.7;">Generar Eliminatorias</button>
    </div>
    <div id="elimFases" style="display:none;">
      <div class="fase-titulo">Octavos de Final</div>
      <form id="octavosForm" autocomplete="off">
        <div class="eliminatorias-round" id="octavos"></div>
        <!-- Eliminar el botón de Resultados Automáticos para Octavos -->
        <button type="button" id="btnCargarCuartos" class="automatic-button" disabled>Ver Cuartos de Final</button>
      </form>
      <div id="cuartosWrapper" style="display:none;">
        <div class="fase-titulo">Cuartos de Final</div>
        <!-- Se ha quitado el botón de Resultados Automáticos para Cuartos -->
        <div class="cuadro-elim" id="cuartos"></div>
        <button type="button" id="btnVerSemis" class="automatic-button">Ver Semifinales</button>
      </div>
      <div id="semisWrapper" style="display:none;">
        <div class="fase-titulo">Semifinales</div>
        <div class="cuadro-elim" id="semis"></div>
        <button type="button" id="btnVerFinal" class="automatic-button">Ver Final</button>
      </div>
      <div id="finalWrapper" style="display:none;">
        <div class="fase-titulo">Final</div>
        <div class="cuadro-elim" id="final"></div>
        <button type="button" id="btnVerCampeon" class="automatic-button">Ver Campeón</button>
      </div>
    </div>
    <script>
      // --- FASE DE GRUPOS ---
      const grupos = [
        {
          nombre: "Grupo A",
          equipos: ["Al-Ahly", "Inter Miami", "Palmeiras", "Porto"],
          partidos: [
            { local: "Al-Ahly", visitante: "Inter Miami" },
            { local: "Palmeiras", visitante: "Porto" },
            { local: "Palmeiras", visitante: "Al-Ahly" },
            { local: "Inter Miami", visitante: "Porto" },
            { local: "Inter Miami", visitante: "Palmeiras" },
            { local: "Porto", visitante: "Al-Ahly" }
          ]
        },
        {
          nombre: "Grupo B",
          equipos: ["PSG", "Atlético de Madrid", "Botafogo", "Seattle Sounders"],
          partidos: [
            { local: "PSG", visitante: "Atlético de Madrid" },
            { local: "Botafogo", visitante: "Seattle Sounders" },
            { local: "PSG", visitante: "Botafogo" },
            { local: "Seattle Sounders", visitante: "Atlético de Madrid" },
            { local: "Seattle Sounders", visitante: "PSG" },
            { local: "Atlético de Madrid", visitante: "Botafogo" }
          ]
        },
        {
          nombre: "Grupo C",
          equipos: ["Bayern Múnich", "Auckland City", "Boca Juniors", "Benfica"],
          partidos: [
            { local: "Bayern Múnich", visitante: "Auckland City" },
            { local: "Boca Juniors", visitante: "Benfica" },
            { local: "Bayern Múnich", visitante: "Boca Juniors" },
            { local: "Benfica", visitante: "Auckland City" },
            { local: "Benfica", visitante: "Bayern Múnich" },
            { local: "Auckland City", visitante: "Boca Juniors" }
          ]
        },
        {
          nombre: "Grupo D",
          equipos: ["Flamengo", "Espérance de Tunis", "Chelsea", "Los Angeles FC"],
          partidos: [
            { local: "Flamengo", visitante: "Espérance de Tunis" },
            { local: "Chelsea", visitante: "Los Angeles FC" },
            { local: "Flamengo", visitante: "Chelsea" },
            { local: "Los Angeles FC", visitante: "Espérance de Tunis" },
            { local: "Los Angeles FC", visitante: "Flamengo" },
            { local: "Espérance de Tunis", visitante: "Chelsea" }
          ]
        },
        {
          nombre: "Grupo E",
          equipos: ["River Plate", "Urawa Red Diamonds", "Monterrey", "Inter de Milán"],
          partidos: [
            { local: "River Plate", visitante: "Urawa Red Diamonds" },
            { local: "Monterrey", visitante: "Inter de Milán" },
            { local: "River Plate", visitante: "Monterrey" },
            { local: "Inter de Milán", visitante: "Urawa Red Diamonds" },
            { local: "Inter de Milán", visitante: "River Plate" },
            { local: "Urawa Red Diamonds", visitante: "Monterrey" }
          ]
        },
        {
          nombre: "Grupo F",
          equipos: ["Fluminense", "Borussia Dortmund", "Ulsan HD", "Mamelodi Sundowns"],
          partidos: [
            { local: "Fluminense", visitante: "Borussia Dortmund" },
            { local: "Ulsan HD", visitante: "Mamelodi Sundowns" },
            { local: "Fluminense", visitante: "Ulsan HD" },
            { local: "Mamelodi Sundowns", visitante: "Borussia Dortmund" },
            { local: "Mamelodi Sundowns", visitante: "Fluminense" },
            { local: "Borussia Dortmund", visitante: "Ulsan HD" }
          ]
        },
        {
          nombre: "Grupo G",
          equipos: ["Manchester City", "Wydad Casablanca", "Al-Ain", "Juventus"],
          partidos: [
            { local: "Manchester City", visitante: "Wydad Casablanca" },
            { local: "Al-Ain", visitante: "Juventus" },
            { local: "Manchester City", visitante: "Al-Ain" },
            { local: "Juventus", visitante: "Wydad Casablanca" },
            { local: "Juventus", visitante: "Manchester City" },
            { local: "Wydad Casablanca", visitante: "Al-Ain" }
          ]
        },
        {
          nombre: "Grupo H",
          equipos: ["Real Madrid", "Al-Hilal", "Pachuca", "Salzburgo"],
          partidos: [
            { local: "Real Madrid", visitante: "Al-Hilal" },
            { local: "Pachuca", visitante: "Salzburgo" },
            { local: "Real Madrid", visitante: "Pachuca" },
            { local: "Salzburgo", visitante: "Al-Hilal" },
            { local: "Salzburgo", visitante: "Real Madrid" },
            { local: "Al-Hilal", visitante: "Pachuca" }
          ]
        }
      ];
      
      const banderas = {
        "Al-Ahly": "https://upload.wikimedia.org/wikipedia/commons/f/fe/Flag_of_Egypt.svg",
        "Inter Miami": "https://upload.wikimedia.org/wikipedia/commons/a/a4/Flag_of_the_United_States.svg",
        Palmeiras: "https://upload.wikimedia.org/wikipedia/commons/0/05/Flag_of_Brazil.svg",
        Porto: "https://upload.wikimedia.org/wikipedia/commons/5/5c/Flag_of_Portugal.svg",
        PSG: "https://upload.wikimedia.org/wikipedia/commons/c/c3/Flag_of_France.svg",
        "Atlético de Madrid": "https://upload.wikimedia.org/wikipedia/commons/9/9a/Flag_of_Spain.svg",
        Botafogo: "https://upload.wikimedia.org/wikipedia/commons/0/05/Flag_of_Brazil.svg",
        "Seattle Sounders": "https://upload.wikimedia.org/wikipedia/commons/a/a4/Flag_of_the_United_States.svg",
        "Bayern Múnich": "https://upload.wikimedia.org/wikipedia/commons/b/ba/Flag_of_Germany.svg",
        "Auckland City": "https://upload.wikimedia.org/wikipedia/commons/3/3e/Flag_of_New_Zealand.svg",
        "Boca Juniors": "https://upload.wikimedia.org/wikipedia/commons/1/1a/Flag_of_Argentina.svg",
        Benfica: "https://upload.wikimedia.org/wikipedia/commons/5/5c/Flag_of_Portugal.svg",
        Flamengo: "https://upload.wikimedia.org/wikipedia/commons/0/05/Flag_of_Brazil.svg",
        "Espérance de Tunis": "https://upload.wikimedia.org/wikipedia/commons/c/ce/Flag_of_Tunisia.svg",
        Chelsea: "https://upload.wikimedia.org/wikipedia/commons/b/be/Flag_of_England.svg",
        "Los Angeles FC": "https://upload.wikimedia.org/wikipedia/commons/a/a4/Flag_of_the_United_States.svg",
        LAFC: "https://upload.wikimedia.org/wikipedia/commons/a/a4/Flag_of_the_United_States.svg",
        "River Plate": "https://upload.wikimedia.org/wikipedia/commons/1/1a/Flag_of_Argentina.svg",
        "Urawa Red Diamonds": "https://upload.wikimedia.org/wikipedia/commons/9/9e/Flag_of_Japan.svg",
        Monterrey: "https://upload.wikimedia.org/wikipedia/commons/f/fc/Flag_of_Mexico.svg",
        "Inter de Milán": "https://upload.wikimedia.org/wikipedia/commons/0/03/Flag_of_Italy.svg",
        Fluminense: "https://upload.wikimedia.org/wikipedia/commons/0/05/Flag_of_Brazil.svg",
        "Borussia Dortmund": "https://upload.wikimedia.org/wikipedia/commons/b/ba/Flag_of_Germany.svg",
        "Ulsan HD": "https://upload.wikimedia.org/wikipedia/commons/0/09/Flag_of_South_Korea.svg",
        "Mamelodi Sundowns": "https://upload.wikimedia.org/wikipedia/commons/a/af/Flag_of_South_Africa.svg",
        "Manchester City": "https://upload.wikimedia.org/wikipedia/commons/b/be/Flag_of_England.svg",
        "Wydad Casablanca": "https://upload.wikimedia.org/wikipedia/commons/2/2c/Flag_of_Morocco.svg",
        "Al-Ain": "https://upload.wikimedia.org/wikipedia/commons/c/cb/Flag_of_the_United_Arab_Emirates.svg",
        Juventus: "https://upload.wikimedia.org/wikipedia/commons/0/03/Flag_of_Italy.svg",
        "Real Madrid": "https://upload.wikimedia.org/wikipedia/commons/9/9a/Flag_of_Spain.svg",
        "Al-Hilal": "https://upload.wikimedia.org/wikipedia/commons/0/0d/Flag_of_Saudi_Arabia.svg",
        Pachuca: "https://upload.wikimedia.org/wikipedia/commons/f/fc/Flag_of_Mexico.svg",
        Salzburgo: "https://upload.wikimedia.org/wikipedia/commons/4/41/Flag_of_Austria.svg"
      };
      
      let gruposData = grupos.map((grupo, idx) => ({
        id: idx,
        nombre: grupo.nombre,
        equipos: grupo.equipos,
        partidos: grupo.partidos.map(p => ({
          local: p.local,
          visitante: p.visitante,
          golesLocal: "",
          golesVisitante: ""
        })),
        posiciones: grupo.equipos.map(e => ({
          equipo: e,
          bandera: banderas[e],
          pts: 0,
          pj: 0,
          pg: 0,
          pe: 0,
          pp: 0,
          gf: 0,
          gc: 0,
          dif: 0
        }))
      }));
      
      let navHtml = "";
      for (let i = 0; i < grupos.length; i++) {
        navHtml += `<button class="grupos-nav-btn${i === 0 ? " active" : ""}" onclick="mostrarGrupo(${i})" id="btnGrupo${i}">${String.fromCharCode(65 + i)}</button>`;
      }
      document.getElementById("gruposNav").innerHTML = navHtml;
      
      let contentHtml = "";
      for (let i = 0; i < gruposData.length; i++) {
        let grupo = gruposData[i];
        contentHtml += `<div class="grupo-box${i === 0 ? " active" : ""}" id="grupoBox${i}">
          <div class="grupo-nombre">${grupo.nombre}</div>
          <div class="grupo-partidos" id="partidosGrupo${i}"></div>
          <div id="tablaGrupo${i}"></div>
        </div>`;
      }
      document.getElementById("gruposContent").innerHTML = contentHtml;
      
      function renderTablaGrupo(grupo, gid) {
        let posiciones = calcularPosiciones(grupo);
        let html = `<div class="tabla-posiciones-wrapper"><table class="posiciones"><thead><tr>
          <th>Pos</th><th></th><th>Equipo</th><th>Pts</th><th>PJ</th><th>PG</th><th>PE</th><th>PP</th><th>GF</th><th>GC</th><th>Dif</th>
        </tr></thead><tbody>`;
        for (let i = 0; i < posiciones.length; i++) {
          let p = posiciones[i],
              primeros = i === 0 || i === 1 ? "primeros" : "";
          html += `<tr class="${primeros}">
            <td>${i + 1}</td>
            <td><img class="bandera-equipo" src="${p.bandera}" alt="Bandera"></td>
            <td class="equipo-nombre" title="${p.equipo}">${p.equipo}</td>
            <td>${p.pts}</td>
            <td>${p.pj}</td>
            <td>${p.pg}</td>
            <td>${p.pe}</td>
            <td>${p.pp}</td>
            <td>${p.gf}</td>
            <td>${p.gc}</td>
            <td>${p.dif > 0 ? "+" : ""}${p.dif}</td>
          </tr>`;
        }
        html += `</tbody></table></div>`;
        return html;
      }
      
      function calcularPosiciones(grupo) {
        let tabla = grupo.equipos.map(e => ({
          equipo: e,
          bandera: banderas[e],
          pts: 0,
          pj: 0,
          pg: 0,
          pe: 0,
          pp: 0,
          gf: 0,
          gc: 0,
          dif: 0
        }));
        grupo.partidos.forEach(p => {
          if (p.golesLocal === "" || p.golesVisitante === "") return;
          let gl = Number(p.golesLocal), gv = Number(p.golesVisitante);
          if (!Number.isFinite(gl) || !Number.isFinite(gv)) return;
          let idxL = tabla.findIndex(x => x.equipo === p.local),
              idxV = tabla.findIndex(x => x.equipo === p.visitante);
          tabla[idxL].pj++;
          tabla[idxV].pj++;
          tabla[idxL].gf += gl;
          tabla[idxL].gc += gv;
          tabla[idxV].gf += gv;
          tabla[idxV].gc += gl;
          if (gl > gv) {
            tabla[idxL].pg++;
            tabla[idxL].pts += 3;
            tabla[idxV].pp++;
          } else if (gl < gv) {
            tabla[idxV].pg++;
            tabla[idxV].pts += 3;
            tabla[idxL].pp++;
          } else {
            tabla[idxL].pe++;
            tabla[idxV].pe++;
            tabla[idxL].pts++;
            tabla[idxV].pts++;
          }
        });
        tabla.forEach(x => (x.dif = x.gf - x.gc));
        tabla.sort((a, b) =>
          b.pts - a.pts || b.dif - a.dif || b.gf - a.gf || a.equipo.localeCompare(b.equipo)
        );
        grupo.posiciones = tabla;
        return tabla;
      }
      
      function renderGrupo(idx) {
        let grupo = gruposData[idx];
        let html = "";
        grupo.partidos.forEach((p, pidx) => {
          html += `<div class="partido-grupo">
            <span class="equipo-partido equipo-local">
              <img class="bandera-equipo" src="${banderas[p.local]}" alt="Bandera">
              <span title="${p.local}">${p.local}</span>
            </span>
            <span class="resultado-box">
              <input class="resultado-input" type="number" min="0" max="99" value="${p.golesLocal}" id="g${idx}_${pidx}_l" onchange="setResultado(${idx},${pidx},'l')" oninput="setResultado(${idx},${pidx},'l')">
            </span>
            <span class="guion-res">-</span>
            <span class="resultado-box">
              <input class="resultado-input" type="number" min="0" max="99" value="${p.golesVisitante}" id="g${idx}_${pidx}_v" onchange="setResultado(${idx},${pidx},'v')" oninput="setResultado(${idx},${pidx},'v')">
            </span>
            <span class="equipo-partido equipo-visitante">
              <img class="bandera-equipo" src="${banderas[p.visitante]}" alt="Bandera">
              <span title="${p.visitante}">${p.visitante}</span>
            </span>
          </div>`;
        });
        document.getElementById(`partidosGrupo${idx}`).innerHTML = html;
        document.getElementById(`tablaGrupo${idx}`).innerHTML = renderTablaGrupo(grupo, idx);
        checkAvanzarElim();
      }
      
      for (let i = 0; i < gruposData.length; i++) {
        renderGrupo(i);
      }
      
      window.mostrarGrupo = function (idx) {
        for (let i = 0; i < gruposData.length; i++) {
          document.getElementById(`grupoBox${i}`).classList.remove("active");
          document.getElementById(`btnGrupo${i}`).classList.remove("active");
        }
        document.getElementById(`grupoBox${idx}`).classList.add("active");
        document.getElementById(`btnGrupo${idx}`).classList.add("active");
      };
      
      window.setResultado = function (grupoIdx, partidoIdx, quien) {
        let grupo = gruposData[grupoIdx];
        let p = grupo.partidos[partidoIdx];
        let valL = document.getElementById(`g${grupoIdx}_${partidoIdx}_l`).value;
        let valV = document.getElementById(`g${grupoIdx}_${partidoIdx}_v`).value;
        p.golesLocal = valL === "" ? "" : Math.max(0, Math.min(99, parseInt(valL, 10)));
        p.golesVisitante = valV === "" ? "" : Math.max(0, Math.min(99, parseInt(valV, 10)));
        renderGrupo(grupoIdx);
      };
      
      function checkAvanzarElim() {
        let completos = true;
        for (let g = 0; g < gruposData.length; g++) {
          for (let p of gruposData[g].partidos) {
            if (p.golesLocal === "" || p.golesVisitante === "") {
              completos = false;
              break;
            }
          }
          if (!completos) break;
        }
        const btn = document.getElementById("btnAvanzarElim");
        if (completos) {
          btn.classList.add("enabled");
          btn.disabled = false;
          btn.style.opacity = 1;
          btn.style.cursor = "pointer";
        } else {
          btn.classList.remove("enabled");
          btn.disabled = true;
          btn.style.opacity = 0.7;
          btn.style.cursor = "not-allowed";
        }
      }
      
      function resultadosAutomaticos() {
        gruposData.forEach((grupo, idx) => {
          grupo.partidos.forEach(p => {
            p.golesLocal = Math.floor(Math.random() * 6);
            p.golesVisitante = Math.floor(Math.random() * 6);
          });
          renderGrupo(idx);
        });
      }
      document.getElementById("btnResultadosAutomaticos").addEventListener("click", resultadosAutomaticos);
      
      // --- ELIMINATORIAS ---
      const llavesOctavos = [
        [0, 1],
        [2, 3],
        [4, 5],
        [6, 7],
        [1, 0],
        [3, 2],
        [5, 4],
        [7, 6]
      ];
      let octavos = [];
      let cuartos = [];
      let semisMatches = [];
      let finalMatch = {};
      
      function getPrimerosSegundosPorGrupo() {
        let resultados = [];
        for (let i = 0; i < gruposData.length; i++) {
          calcularPosiciones(gruposData[i]);
          resultados.push([
            gruposData[i].posiciones[0].equipo,
            gruposData[i].posiciones[1].equipo
          ]);
        }
        return resultados;
      }
      
      function armarOctavos() {
        let gruposPS = getPrimerosSegundosPorGrupo();
        octavos = llavesOctavos.map((info, idx) => {
          const [g1, g2] = info;
          const local = gruposPS[g1][0];
          const visitante = gruposPS[g2][1];
          return {
            num: idx + 1,
            local,
            visitante,
            golesLocal: "",
            golesVisitante: "",
            ganador: ""
          };
        });
      }
      
      function renderOctavos() {
        let html = "";
        octavos.forEach((p, i) => {
          html += `<div class="partido-elim">
            <span class="num">Partido ${p.num}</span>
            <span class="etiqueta">
              <img class="bandera-equipo" src="${banderas[p.local]}" alt="Bandera">
              ${p.local}
            </span>
            <span class="resultado-box">
              <input class="resultado-input" type="number" min="0" max="99" value="${p.golesLocal}" id="octG${i}_l" onchange="setOctavos(${i})" oninput="setOctavos(${i})">
            </span>
            <span class="guion-res">-</span>
            <span class="resultado-box">
              <input class="resultado-input" type="number" min="0" max="99" value="${p.golesVisitante}" id="octG${i}_v" onchange="setOctavos(${i})" oninput="setOctavos(${i})">
            </span>
            <span class="etiqueta">
              <img class="bandera-equipo" src="${banderas[p.visitante]}" alt="Bandera">
              ${p.visitante}
            </span>
          </div>`;
        });
        document.getElementById("octavos").innerHTML = html;
      }
      
      // This function now only updates the octavos stage (without reinitializing the octavos array)
      function resultadosOctavosAutomaticos() {
        if(octavos.length === 0) return; // Do nothing if octavos are not initialized
        octavos.forEach((match, i) => {
          let score1 = Math.floor(Math.random() * 6);
          let score2 = Math.floor(Math.random() * 6);
          // Ensure there is no draw
          while(score1 === score2) {
            score2 = Math.floor(Math.random() * 6);
          }
          match.golesLocal = score1;
          match.golesVisitante = score2;
          match.ganador = score1 > score2 ? match.local : match.visitante;
          document.getElementById(`octG${i}_l`).value = score1;
          document.getElementById(`octG${i}_v`).value = score2;
        });
        // Update state for each match without affecting other stages
        octavos.forEach((_, i) => setOctavos(i));
      }
      
      function setOctavos(idx) {
        let p = octavos[idx];
        let valL = document.getElementById(`octG${idx}_l`).value;
        let valV = document.getElementById(`octG${idx}_v`).value;
        p.golesLocal = valL === "" ? "" : Math.max(0, Math.min(99, parseInt(valL, 10)));
        p.golesVisitante = valV === "" ? "" : Math.max(0, Math.min(99, parseInt(valV, 10)));
        if (p.golesLocal !== "" && p.golesVisitante !== "" && p.golesLocal !== p.golesVisitante) {
          p.ganador = p.golesLocal > p.golesVisitante ? p.local : p.visitante;
        } else {
          p.ganador = "";
        }
        const allValid = octavos.every(match =>
          match.golesLocal !== "" && match.golesVisitante !== "" && match.golesLocal !== match.golesVisitante
        );
        const btnCuartos = document.getElementById("btnCargarCuartos");
        if (allValid) {
          btnCuartos.disabled = false;
          btnCuartos.classList.add("enabled");
          btnCuartos.style.cursor = "pointer";
        } else {
          btnCuartos.disabled = true;
          btnCuartos.classList.remove("enabled");
          btnCuartos.style.cursor = "not-allowed";
        }
      }
      
      function renderCuartos() {
        // Only initialize cuartos if not yet initialized; this preserves any existing auto-generated scores.
        if (cuartos.length === 0) {
          cuartos = [];
          const cuadros = [[0, 1], [2, 3], [4, 5], [6, 7]];
          cuadros.forEach((par, i) => {
            const equipo1 = octavos[par[0]].ganador || "¿?";
            const equipo2 = octavos[par[1]].ganador || "¿?";
            cuartos.push({
              equipo1,
              equipo2,
              goles1: "",
              goles2: "",
              ganador: ""
            });
          });
        }
        let html = "";
        cuartos.forEach((match, i) => {
          html += `<div class="partido-elim">
            <span class="num">Cuarto ${i + 1}</span>
            <span class="etiqueta">
              <img class="bandera-equipo" src="${banderas[match.equipo1]}" alt="Bandera">
              ${match.equipo1}
            </span>
            <span class="resultado-box">
              <input class="resultado-input" type="number" min="0" max="99" value="${match.goles1}" id="c${i}_g1" onchange="setCuartos(${i})" oninput="setCuartos(${i})">
            </span>
            <span class="guion-res">-</span>
            <span class="resultado-box">
              <input class="resultado-input" type="number" min="0" max="99" value="${match.goles2}" id="c${i}_g2" onchange="setCuartos(${i})" oninput="setCuartos(${i})">
            </span>
            <span class="etiqueta">
              <img class="bandera-equipo" src="${banderas[match.equipo2]}" alt="Bandera">
              ${match.equipo2}
            </span>
          </div>`;
        });
        document.getElementById("cuartos").innerHTML = html;
      }
      
      function resultadosCuartosAutomaticos() {
        if(cuartos.length === 0) return; // Do nothing if cuartos are not yet initialized
        cuartos.forEach((match, i) => {
          let score1 = Math.floor(Math.random() * 6);
          let score2 = Math.floor(Math.random() * 6);
          while(score1 === score2) {
            score2 = Math.floor(Math.random() * 6);
          }
          match.goles1 = score1;
          match.goles2 = score2;
          match.ganador = score1 > score2 ? match.equipo1 : match.equipo2;
          document.getElementById(`c${i}_g1`).value = score1;
          document.getElementById(`c${i}_g2`).value = score2;
        });
        cuartos.forEach((_, i) => setCuartos(i));
      }
      
      function setCuartos(i) {
        let match = cuartos[i];
        let val1 = document.getElementById(`c${i}_g1`).value;
        let val2 = document.getElementById(`c${i}_g2`).value;
        match.goles1 = val1 === "" ? "" : Math.max(0, Math.min(99, parseInt(val1, 10)));
        match.goles2 = val2 === "" ? "" : Math.max(0, Math.min(99, parseInt(val2, 10)));
        if (match.goles1 !== "" && match.goles2 !== "" && match.goles1 !== match.goles2) {
          match.ganador = match.goles1 > match.goles2 ? match.equipo1 : match.equipo2;
        } else {
          match.ganador = "";
        }
      }
      
      function renderSemis() {
        semisMatches = [
          {
            equipo1: cuartos[0].ganador || "¿?",
            equipo2: cuartos[1].ganador || "¿?",
            goles1: "",
            goles2: "",
            ganador: ""
          },
          {
            equipo1: cuartos[2].ganador || "¿?",
            equipo2: cuartos[3].ganador || "¿?",
            goles1: "",
            goles2: "",
            ganador: ""
          }
        ];
        let html = "";
        semisMatches.forEach((match, i) => {
          html += `<div class="partido-elim">
            <span class="num">Semifinal ${i + 1}</span>
            <span class="etiqueta">
              <img class="bandera-equipo" src="${banderas[match.equipo1]}" alt="Bandera">
              ${match.equipo1}
            </span>
            <span class="resultado-box">
              <input class="resultado-input" type="number" min="0" max="99" value="${match.goles1}" id="s${i}_g1" onchange="setSemis(${i})" oninput="setSemis(${i})">
            </span>
            <span class="guion-res">-</span>
            <span class="resultado-box">
              <input class="resultado-input" type="number" min="0" max="99" value="${match.goles2}" id="s${i}_g2" onchange="setSemis(${i})" oninput="setSemis(${i})">
            </span>
            <span class="etiqueta">
              <img class="bandera-equipo" src="${banderas[match.equipo2]}" alt="Bandera">
              ${match.equipo2}
            </span>
          </div>`;
        });
        document.getElementById("semis").innerHTML = html;
      }
      
      function setSemis(i) {
        let match = semisMatches[i];
        let val1 = document.getElementById(`s${i}_g1`).value;
        let val2 = document.getElementById(`s${i}_g2`).value;
        match.goles1 = val1 === "" ? "" : Math.max(0, Math.min(99, parseInt(val1, 10)));
        match.goles2 = val2 === "" ? "" : Math.max(0, Math.min(99, parseInt(val2, 10)));
        if (match.goles1 !== "" && match.goles2 !== "" && match.goles1 !== match.goles2) {
          match.ganador = match.goles1 > match.goles2 ? match.equipo1 : match.equipo2;
        } else {
          match.ganador = "";
        }
      }
      
      function renderFinal() {
        finalMatch = {
          equipo1: semisMatches[0].ganador || "¿?",
          equipo2: semisMatches[1].ganador || "¿?",
          goles1: "",
          goles2: "",
          ganador: ""
        };
        let html = `<div class="partido-elim">
          <span class="num">Final</span>
          <span class="etiqueta">
            <img class="bandera-equipo" src="${banderas[finalMatch.equipo1]}" alt="Bandera">
            ${finalMatch.equipo1}
          </span>
          <span class="resultado-box">
            <input class="resultado-input" type="number" min="0" max="99" value="${finalMatch.goles1}" id="f_g1" onchange="setFinal()" oninput="setFinal()">
          </span>
          <span class="guion-res">-</span>
          <span class="resultado-box">
            <input class="resultado-input" type="number" min="0" max="99" value="${finalMatch.goles2}" id="f_g2" onchange="setFinal()" oninput="setFinal()">
          </span>
          <span class="etiqueta">
            <img class="bandera-equipo" src="${banderas[finalMatch.equipo2]}" alt="Bandera">
            ${finalMatch.equipo2}
          </span>
        </div>`;
        document.getElementById("final").innerHTML = html;
      }
      
      function setFinal() {
        let val1 = document.getElementById("f_g1").value;
        let val2 = document.getElementById("f_g2").value;
        finalMatch.goles1 = val1 === "" ? "" : Math.max(0, Math.min(99, parseInt(val1, 10)));
        finalMatch.goles2 = val2 === "" ? "" : Math.max(0, Math.min(99, parseInt(val2, 10)));
        if (finalMatch.goles1 !== "" && finalMatch.goles2 !== "" && finalMatch.goles1 !== finalMatch.goles2) {
          finalMatch.ganador = finalMatch.goles1 > finalMatch.goles2 ? finalMatch.equipo1 : finalMatch.equipo2;
        } else {
          finalMatch.ganador = "";
        }
      }
      
      document.getElementById("btnAvanzarElim").onclick = function () {
        armarOctavos();
        renderOctavos();
        document.getElementById("elimFases").style.display = "";
        window.scrollTo({
          top: document.getElementById("elimFases").offsetTop - 40,
          behavior: "smooth"
        });
      };
      
      // Note: The button "btnResultadosOctavos" and its event listener have been removed.
      // Likewise, the button "btnResultadosCuartos" and its event listener have been removed.
      
      document.getElementById("btnCargarCuartos").onclick = function () {
        renderCuartos();
        document.getElementById("cuartosWrapper").style.display = "";
        window.scrollTo({
          top: document.getElementById("cuartosWrapper").offsetTop - 24,
          behavior: "smooth"
        });
      };
      
      document.getElementById("btnVerSemis").onclick = function () {
        renderSemis();
        document.getElementById("semisWrapper").style.display = "";
        window.scrollTo({
          top: document.getElementById("semisWrapper").offsetTop - 24,
          behavior: "smooth"
        });
      };
      
      document.getElementById("btnVerFinal").onclick = function () {
        renderFinal();
        document.getElementById("finalWrapper").style.display = "";
        window.scrollTo({
          top: document.getElementById("finalWrapper").offsetTop - 24,
          behavior: "smooth"
        });
      };
      
      document.getElementById("btnVerCampeon").onclick = function () {
        if(finalMatch.ganador) {
          alert("Campeón: " + finalMatch.ganador);
        } else {
          alert("El partido final aún no tiene resultado válido.");
        }
      };
      
      window.setOctavos = setOctavos;
    </script>
  </body>
</html>